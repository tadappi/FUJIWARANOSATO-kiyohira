<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GLB — Autorotate + Wheel Zoom Only</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <style>
    html,body{margin:0;height:100%}
    .hint{
      position:fixed;left:10px;bottom:10px;color:#e0e0e0;
      font:12px/1.5 system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      background:rgba(0,0,0,.35);padding:6px 8px;border-radius:6px
    }
  </style>
</head>
<body>
  <div class="hint">
    ・モデルは最初からずっと自動回転<br>
    ・マウスホイール：ズームイン／アウトのみ（カメラの距離）
  </div>

  <a-scene renderer="colorManagement:true" background="color:#c2c2c2"
    device-orientation-permission-ui="enabled: false"
    xr-mode-ui="enabled: false"
    vr-mode-ui="enabled: false">

    <!-- ライト -->
    <a-entity light="type:ambient;intensity:0.3"></a-entity>
    <a-entity light="type:directional;intensity:0.4" position="2 4 2"></a-entity>

    <!-- モデル：原点中心で回転。XYZ軸は子にして一緒に回す -->
    <a-entity id="modelRoot"
      position="0 0 0"
      rotation="0 135 0"
      auto-spin="speedDegPerSec:4">
      <a-entity axes-helper="size:0.1"></a-entity>

      <!-- ここは自分の glb に合わせてパス/スケール調整 -->
      <a-entity gltf-model="url(./kiyohira.glb)"
                position="0 0 0"
                rotation="0 0 0"
                scale="0.2 0.2 0.2"></a-entity>
    </a-entity>

    <!-- カメラ：Zだけ動かしてズーム -->
    <a-entity id="rig"
      position="0 6 18"
      rotation="-25 0 0">
      <a-entity id="cam" camera="fov:40"></a-entity>
    </a-entity>
  </a-scene>

  <script>
    // ===== XYZ軸（赤X・緑Y・青Z） =====
    AFRAME.registerComponent('axes-helper', {
      schema: { size: {default: 1} },
      init() {
        const axes = new THREE.AxesHelper(this.data.size);
        this.el.setObject3D('mesh', axes);
      }
    });

    // ===== モデルの自動回転（ずっと回りっぱなし） =====
    AFRAME.registerComponent('auto-spin', {
      schema: {
        speedDegPerSec: { default: 4 } // 回転速度（度/秒）
      },
      tick: function (t, dt) {
        const rot = this.el.getAttribute('rotation');
        const dsec = dt / 1000;
        rot.y += this.data.speedDegPerSec * dsec; // Yawのみ
        this.el.setAttribute('rotation', rot);
      }
    });

    // ===== シーン読み込み後：ホイールズームだけ設定 =====
    document.querySelector('a-scene').addEventListener('loaded', () => {
      const scene  = document.querySelector('a-scene');
      const canvas = scene.canvas;
      const rig    = document.querySelector('#rig');

      if (!canvas) return;

      // ズーム範囲と速度
      const minZ = 4;   // これ以上近づかない
      const maxZ = 20;  // これ以上遠ざからない
      const zoomSpeed = 0.01; // deltaYに掛ける係数

      canvas.addEventListener('wheel', (e) => {
        e.preventDefault();

        const pos = rig.getAttribute('position');
        pos.z += e.deltaY * zoomSpeed;
        pos.z = Math.max(minZ, Math.min(maxZ, pos.z));
        rig.setAttribute('position', pos);
      }, { passive: false });
    });
  </script>
</body>
</html>
